<!-- 購物車共用vue -->

<header id="wrapper">
    <div class="yu_wrapper">
            <!-- 購物車 -->
            <div id="i_shoppingCart_bk" class="i_background" style="display:none">
                    <div class="shopping-cart">
                            <div class="row">
                                    <div class="col-12 shopping-cart-items">
                                            <div class="row-md-4 -title">
                                                    <span>購物清單</span>
                                                    <button type="button" class="btn-close"
                                                            id="btn-cart-close"></button>
                                            </div>

                                            <!-- 塞商品 -->
                                            <div class="cart" class="row"
                                                    v-for="product in productsInCart">
                                                    <div class="row -copyPdc">
                                                            <div class="col-4">
                                                                    <img class="img-fluid"
                                                                            :src="product.thumb" />
                                                            </div>
                                                            <div class="col -borderTop">
                                                                    <div class="row text-muted">
                                                                            <li>
                                                                                    {{ product.name
                                                                                    }}
                                                                            </li>
                                                                            <li>
                                                                                    <button @click="remove(product)"
                                                                                            class="delPdc">移除</button>
                                                                            </li>
                                                                    </div>

                                                                    <div
                                                                            class="row -priceAmount align-items-center">
                                                                            <div class="col count">
                                                                                    <div
                                                                                            class='ctrl'>
                                                                                            <button class="ctrl__button ctrl__button--decrement"
                                                                                                    @click="minusOne(product)">-</button>
                                                                                            <div
                                                                                                    class='ctrl__counter'>
                                                                                                    <div
                                                                                                            class='ctrl__counter-num'>
                                                                                                            {{
                                                                                                            product.amount
                                                                                                            }}
                                                                                                    </div>
                                                                                            </div>
                                                                                            <button class="ctrl__button ctrl__button--increment"
                                                                                                    @click="addOne(product)">+</button>
                                                                                    </div>
                                                                            </div>
                                                                            <div
                                                                                    class="col -pdcPrice">
                                                                                    小計$ &nbsp; {{
                                                                                    product.sum }}
                                                                            </div>

                                                                    </div>
                                                            </div>
                                                    </div>
                                            </div>

                                            <div>總計<span class="total-price">$ {{ total }}</span>
                                            </div>
                                    </div>
                            </div>
                            <div class="goCart">
                                    <a class="btncheckS1" href="./checkout1.html">前往結帳</a>
                            </div>
                    </div>
            </div>
            <div class="h_logo">
                    <a href="./index.html"><img src="./img/logo.png" alt=""></a>
            </div>
            <div class="h_navbar">
                    <div class="h_nav">
                            <ul>
                                    <li><a href="./login.html"><i
                                                            class="fa-solid fa-user head_icon"></i></a>
                                    </li>
                                    <li><a @click="openCart" id="i_shoppingCart" href="#">
                                                    <i
                                                            class="fa-solid fa-cart-shopping head_icon"></i>
                                            </a></li>

                            </ul>
                            <nav>
                                    <button class="hamburger hamburger--squeeze" type="button">
                                            <span class="hamburger-box">
                                                    <span class="hamburger-inner"></span>
                                            </span>
                                    </button>
                                    <div class="nav-list">
                                            <ul class="nav_top">
                                                    <ol><a href="./index.html">首頁</a></ol>
                                                    <ol><a href="./about.html">關於畫廊</a></ol>
                                                    <ol><a href="./online_gallery.html">線上畫廊</a>
                                                    </ol>
                                                    <ol><a href="./exhibition.html">當今展覽</a></ol>
                                                    <ol class="sub-nav">藝術體驗<i id="tg1"
                                                                    class="fas fa-plus-square"></i>
                                                            <li><a href="./puzzle_choice.html"
                                                                            target="_blank">拼圖遊戲</a>
                                                            </li>
                                                            <li><a href="./psychol_test.html"
                                                                            id="sub-nav_color2">心理測驗</a>
                                                            </li>
                                                    </ol>
                                                    <ol><a href="./shop.html">商品總覽</a></ol>
                                                    <ol class="sub-nav2">會員中心<i id="tg2"
                                                                    class="fas fa-plus-square"></i>
                                                            <li><a href="./login.html">註冊/登入</a>
                                                            </li>
                                                            <li><a href="./member.html">訂單查詢</a>
                                                            </li>
                                                    </ol>
                                            </ul>
                                    </div>
                            </nav>
                    </div>
            </div>
    </div>

</header>
<!-- <script src="./js/header_vue.min.js"></script> -->

<script>
    
    new Vue({
            el: '#wrapper',
            data: {
                    // isShowingCart: false,
                    products: [
                            {
                                    id: '1',
                                    title: 'Ginevra Benci ｜ 複製畫',
                                    price: 1000,
                                    thumb: './img/Shop/products/D/p1.png',
                                    amount: 0,
                                    amountShow: 1,
                                    showingIcon: false
                            },
                            {
                                    id: '2',
                                    title: '救世主 ｜ 複製畫',
                                    price: 2000,
                                    thumb: './img/Shop/products/D/p2.png',
                                    amount: 0,
                                    amountShow: 1,
                                    showingIcon: false
                            },
                    ]
            },
            created() {
               
                    const old_data = localStorage.getItem('items') // 看購物車有沒有東西
                    if (old_data) {
                            let value = JSON.parse(old_data);
                            this.products = value
                            console.log('6456');

                    }
            },


            methods: {
                    openCart() {
                            // 顯示購物車
                            var shoppingcartbk = document.getElementById('i_shoppingCart_bk');
                            if (shoppingcartbk.style.display === 'none') {
                                    shoppingcartbk.style.display = 'block';
                            };

                            //可以試著用toggle
                            var close = document.getElementsByClassName('btn-close');
                            for (let i = 0; i < close.length; i++) {
                                    close[i].addEventListener('click', function () {
                                            if (this.closest('.i_background').style.display === 'block') {
                                                    this.closest('.i_background').style.display = 'none';
                                            }
                                    });
                            };
                    },

                    // 點擊 - / + 後的動作
                    minusOne(product) {
                            product.amount--
                            product.amount = (product.amount < 1) ? 1 : product.amount
                    },
                    addOne(product) {
                            product.amount++
                            product.amount = (product.amount > 50) ? 50 : product.amount
                    },

                    // 點擊 add to cart 後的動作
                    addToCart(product) {
                            product.amount += product.amountShow
                            product.showingIcon = true
                            setTimeout(() => {
                                    product.showingIcon = false
                            }, 800)
                            localStorage.setItem('items', JSON.stringify(this.products));
                            console.log('a');
                            // this.push(product).JSON.parse(localStorage.getItem('items'));
                            // console.log(item);
                    },
                    // 在購物車裡移除單一品項 ( 把數量設置成 0 )
                    remove(product) {
                            product.amount = 0
                    },

            },

            computed: {
                    // 購物車裡的品項
                    productsInCart() {
                            return this.products

                                    // 只顯示購買數量 > 0 的項目
                                    .filter(p => p.amount)
                                    // 算出每個產品的小計
                                    .map(p => {
                                            p.sum = p.amount * p.price
                                            return p
                                    })
                    },

                    // 木前購買的金額
                    total() {
                            return this.productsInCart
                                    .reduce((sum, p) => (sum + p.sum), 0)
                    }
            },
    });

// const publicMixin = {
//             // el: '#shopTest',
//             data() {
//                     // isShowingCart: false,
//                     products: [
//                             {
//                                     id: '1',
//                                     title: 'Ginevra Benci ｜ 複製畫',
//                                     price: 1000,
//                                     thumb: './img/Shop/products/D/p1.png',
//                                     amount: 0,
//                                     amountShow: 1,
//                                     showingIcon: false
//                             },
//                             {
//                                     id: '2',
//                                     title: '救世主 ｜ 複製畫',
//                                     price: 2000,
//                                     thumb: './img/Shop/products/D/p2.png',
//                                     amount: 0,
//                                     amountShow: 1,
//                                     showingIcon: false
//                             },
//                     ]
//             },
//             created() {
               
//                     const old_data = localStorage.getItem('items') // 看購物車有沒有東西
//                     if (old_data) {
//                             let value = JSON.parse(old_data);
//                             this.products = value
//                             console.log(
//                                     '6456'
//                             );

//                     }
//             },


//             methods: {
//                     openCart() {
//                             // 顯示購物車
//                             var shoppingcartbk = document.getElementById('i_shoppingCart_bk');
//                             if (shoppingcartbk.style.display === 'none') {
//                                     shoppingcartbk.style.display = 'block';
//                             };

//                             //可以試著用toggle
//                             var close = document.getElementsByClassName('btn-close');
//                             for (let i = 0; i < close.length; i++) {
//                                     close[i].addEventListener('click', function () {
//                                             if (this.closest('.i_background').style.display === 'block') {
//                                                     this.closest('.i_background').style.display = 'none';
//                                             }
//                                     });
//                             };
//                     },

//                     // 點擊 - / + 後的動作
//                     minusOne(product) {
//                             product.amount--
//                             product.amount = (product.amount < 1) ? 1 : product.amount
//                     },
//                     addOne(product) {
//                             product.amount++
//                             product.amount = (product.amount > 50) ? 50 : product.amount
//                     },

//                     // 點擊 add to cart 後的動作
//                     addToCart(product) {
//                             product.amount += product.amountShow
//                             product.showingIcon = true
//                             setTimeout(() => {
//                                     product.showingIcon = false
//                             }, 800)
//                             localStorage.setItem('items', JSON.stringify(this.products));
//                             console.log('a');
//                             // this.push(product).JSON.parse(localStorage.getItem('items'));
//                             // console.log(item);
//                     },
//                     // 在購物車裡移除單一品項 ( 把數量設置成 0 )
//                     remove(product) {
//                             product.amount = 0
//                     },

//             },

//             computed: {
//                     // 購物車裡的品項
//                     productsInCart() {
//                             return this.products

//                                     // 只顯示購買數量 > 0 的項目
//                                     .filter(p => p.amount)
//                                     // 算出每個產品的小計
//                                     .map(p => {
//                                             p.sum = p.amount * p.price
//                                             return p
//                                     })
//                     },

//                     // 木前購買的金額
//                     total() {
//                             return this.productsInCart
//                                     .reduce((sum, p) => (sum + p.sum), 0)
//                     }
//             },
//     };
    

</script>